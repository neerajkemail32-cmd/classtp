<script>
  // ðŸ”‘ Set this once to your Render URL
  const API_BASE = "https://classtp.onrender.com/"; // replace with your actual Render URL

  let allStudents = [];

  // Open student management page
  function openStudents() {
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('studentPage').classList.remove('hidden');
  }

  // Go back to main menu
  function goBack() {
    document.getElementById('studentPage').classList.add('hidden');
    document.getElementById('mainMenu').classList.remove('hidden');
  }

  // Load all students
  function loadAllStudents() {
    document.getElementById('studentsList').innerHTML = '<tr><td colspan="6" class="text-center">Loading...</td></tr>';

    fetch(`${API_BASE}/students`)
      .then(response => response.json())
      .then(students => {
        allStudents = students;
        showStudents(students);
      })
      .catch(error => {
        alert('Error loading students. Check server on Render!');
        console.error(error);
      });
  }

  // Show students in table
  function showStudents(students) {
    const tbody = document.getElementById('studentsList');

    if (students.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="text-center">No students found</td></tr>';
      return;
    }

    tbody.innerHTML = students.map(student => `
      <tr>
        <td>${student.id}</td>
        <td>${student.fullName}</td>
        <td>${student.email}</td>
        <td>${student.mobile}</td>
        <td>${student.batch || 'N/A'}</td>
        <td>
          <button class="btn btn-sm btn-info me-1" onclick="viewStudent(${student.id})">View</button>
          <button class="btn btn-sm btn-warning me-1" onclick="editStudent(${student.id})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteStudent(${student.id})">Delete</button>
        </td>
      </tr>
    `).join('');
  }

  // Search box
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('searchBox').addEventListener('input', function () {
      const searchText = this.value.toLowerCase();
      if (!allStudents.length) return;
      if (!searchText) return showStudents(allStudents);

      const filtered = allStudents.filter(s =>
        s.fullName.toLowerCase().includes(searchText) ||
        s.email.toLowerCase().includes(searchText)
      );
      showStudents(filtered);
    });
  });

  // Add student
  document.getElementById('studentForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const newStudent = {
      fullName: document.getElementById('name').value,
      email: document.getElementById('email').value,
      mobile: document.getElementById('mobile').value,
      batch: document.getElementById('batch').value,
      password: '123456'
    };

    fetch(`${API_BASE}/students`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(newStudent)
    })
      .then(r => {
        if (r.ok) {
          alert('Student added successfully!');
          this.reset();
          loadAllStudents();
        } else {
          alert('Error adding student!');
        }
      })
      .catch(err => alert('Error: ' + err.message));
  });

  // View student
  function viewStudent(id) {
    const s = allStudents.find(st => st.id === id);
    if (s) {
      alert(`Student Details:
Name: ${s.fullName}
Email: ${s.email}
Mobile: ${s.mobile}
Batch: ${s.batch || 'Not assigned'}`);
    }
  }

  // Edit student
  function editStudent(id) {
    const s = allStudents.find(st => st.id === id);
    if (!s) return;

    const updated = {
      fullName: prompt('Enter new name:', s.fullName) || s.fullName,
      email: prompt('Enter new email:', s.email) || s.email,
      mobile: prompt('Enter new mobile:', s.mobile) || s.mobile,
      batch: prompt('Enter new batch:', s.batch) || s.batch
    };

    fetch(`${API_BASE}/students/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updated)
    })
      .then(r => {
        if (r.ok) {
          alert('Student updated successfully!');
          loadAllStudents();
        } else {
          alert('Error updating student!');
        }
      })
      .catch(err => alert('Error: ' + err.message));
  }

  // Delete student
  function deleteStudent(id) {
    if (!confirm('Delete this student?')) return;

    fetch(`${API_BASE}/students/${id}`, { method: 'DELETE' })
      .then(r => {
        if (r.ok) {
          alert('Student deleted!');
          loadAllStudents();
        } else {
          alert('Error deleting student!');
        }
      })
      .catch(err => alert('Error: ' + err.message));
  }
</script>
